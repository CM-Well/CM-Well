name: CI

on: [pull_request]

jobs:
  compile:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v1
      - name: Run sbt compile
        run: |
          echo pwd
          cd server
          sbt compile

# Took 2:43 instead of 1:01 at the other version! 
##      - name: Run sbt test - version1
##        run: |
##          echo pwd
##          cd server
##          sbt util/test
##          sbt kafkaAssigner/test
##          sbt dao/test
#          sbt domain/test

      - name: Run sbt test - version2
        run: |
          echo pwd
          cd server
          sbt util/test kafkaAssigner/test dao/test domain/test
          
      - uses: actions/checkout@v1
      - name: Run sbt test
        run: |
          echo pwd
          cd server
          sbt zstore/test common/test grid/test

      - uses: actions/upload-artifact@master
        with:
          name: my-artifacts
          path: cmwell-grid/target/logs
      - uses: actions/upload-artifact@master
        if: always()
        with:
          name: application.log
          path: server/cmwell-grid/target/logs/application.log
      - uses: actions/upload-artifact@master
        if: always()
        with:
          name: client1.out
          path: server/cmwell-grid/target/client1.out
      - uses: actions/upload-artifact@master
        if: always()
        with:
          name: client2.out
          path: server/cmwell-grid/target/client2.out
      - uses: actions/upload-artifact@master
        if: always()
        with:
          name: node.out
          path: server/cmwell-grid/target/node.out


  test_3_FTS_RTS:

    runs-on: ubuntu-latest
    needs: compile

    steps:
      - uses: actions/checkout@v1
      - name: Run sbt test
        run: |
          echo pwd
          cd server
          sbt rts/test
          sbt fts/test

  test_4:

    runs-on: ubuntu-latest
    needs: compile

    steps:
      - uses: actions/checkout@v1
      - name: Run sbt test
        run: |
          echo pwd
          cd server
          sbt formats/test
          sbt irw/test
          sbt stortill/test

  test_bg:

    runs-on: ubuntu-latest
    needs: compile

    steps:
      - uses: actions/checkout@v1
      - name: Run sbt test
        run: |
          echo pwd
          cd server
          sbt bg/test

  test_it:

    runs-on: ubuntu-latest
    needs: compile

    steps:
      - uses: actions/checkout@v1
      - name: Run sbt test
        run: |
          echo pwd
          cd server
          sbt consIt/test

  test_6:

    runs-on: ubuntu-latest
    needs: compile

    steps:
      - uses: actions/checkout@v1
      - name: Run sbt test
        run: |
          echo pwd
          cd server
          sbt ctrl/test
          sbt dc/test
          sbt cons/test
          sbt pluginGremlin/test

  test_7:

    runs-on: ubuntu-latest
    needs: compile

    steps:
      - uses: actions/checkout@v1
      - name: Run sbt test
        run: |
          echo pwd
          cd server
          sbt spa/test
          sbt dataTools/test
          sbt dataToolsApp/test

  test_8:

    runs-on: ubuntu-latest
    needs: compile

    steps:
      - uses: actions/checkout@v1
      - name: Run sbt test
        run: |
          echo pwd
          cd server
          sbt sparqlAgent/test
          sbt tracking/test
          sbt ws/test
